# RSpec SonarQube Formatter

[RSpec 3](https://rspec.info/) formatter that generates an XML file for [SonarQube](https://www.sonarqube.org/) and
[SonarCloud][sonarcloud]Ô∏è, using the [Generic Test Data](https://docs.sonarqube.org/latest/analysis/generic-test/) format.

[![Gem Version](https://img.shields.io/gem/v/rspec-sonarqube-formatter?style=for-the-badge&logo=rubygems&logoColor=aaa&color=367cd3)][rubygems]
[![Gem Downloads](https://img.shields.io/gem/dt/rspec-sonarqube-formatter?style=for-the-badge&logo=ruby&logoColor=aaa&color=367cd3)][rubygems]
[![GitHub issues](https://img.shields.io/github/issues/otherguy/rspec-sonarqube-formatter?style=for-the-badge&logo=github)][issues]
[![License](https://img.shields.io/github/license/otherguy/rspec-sonarqube-formatter?style=for-the-badge&logo=readthedocs&logoColor=aaa)][license]
[![Codecov](https://img.shields.io/codecov/c/github/otherguy/rspec-sonarqube-formatter?style=for-the-badge&logo=codecov&logoColor=aaa)][codecov]
[![Sonar Quality Gate](https://img.shields.io/sonar/quality_gate/otherguy_rspec-sonarqube-formatter?server=https%3A%2F%2Fsonarcloud.io&style=for-the-badge&logo=sonarcloud&logoColor=aaa)][sonarcloud]
[![Violations](https://img.shields.io/sonar/violations/otherguy_rspec-sonarqube-formatter?server=https%3A%2F%2Fsonarcloud.io&format=short&style=for-the-badge&logo=sonarcloud&logoColor=aaa)][sonarcloud]
[![Code Climate maintainability](https://img.shields.io/codeclimate/maintainability/otherguy/rspec-sonarqube-formatter?style=for-the-badge&logo=codeclimate)][codeclimate]


## Features üåà

This formatter generates an XML report that can be read by [SonarQube](https://www.sonarqube.org/) and [SonarCloud][sonarcloud]Ô∏è.

Out of the box, SonarQube 6.2+ and SonarCloud support generic formats for test coverage and test execution import.
Using the XML file generated by this gem, you get an overview of test executions (`passed`, `skipped`, `failed`) and
the time in milliseconds it took to execute these.

[![Sonarcloud.io](documentation/sonarcloud.png)][sonarcloud]Ô∏è

## Installation üöÄ

Add the gem to your application's `Gemfile`:

```ruby
# RSpec formatters
gem 'rspec-sonarqube-formatter', '~> 1.6', require: false
```

Then, update your bundle:

```bash
$ bundle install
```

Or install it manually using:

```bash
$ gem install rspec-sonarqube-formatter
```

## Usage üõ†

Add the following code to your `spec_helper.rb`:

```ruby
RSpec.configure do |c|
  c.formatter = 'documentation'
  c.add_formatter('RspecSonarqubeFormatter', 'out/test-report.xml')
  ...
end
```

Alternatively, edit your `.rspec` file to define your formatters there:

```bash
# .rspec
--require spec_helper
--color
--format RspecSonarqubeFormatter
--out out/test-report.xml
--format documentation
```

To make SonarQube read the test report, specify the path to the generated XML in your
[`sonar-project.properties`](sonar-project.properties) or configure it in the SonarQube GUI.

```bash
# sonar-project.properties
sonar.testExecutionReportPaths=out/test-report.xml
```

## Inspiration üíÖ

The only [existing formatter](https://github.com/witjoh/rspec_sonar_formatter) does not work out of the box and is not
published to [RubyGems.org](https://rubygems.org/gems/rspec-sonarqube-formatter), so I created my own.

Thank you to [`@witjoh`](https://github.com/witjoh) for the original work ‚ô•Ô∏è!

## Contributing üöß

Bug reports and pull requests are welcome on GitHub at [`otherguy/rspec-sonarqube-formatter`](https://github.com/otherguy/rspec-sonarqube-formatter).

After checking out the repository, you need to install dependencies:

```bash
gem install bundler
bundle install
```

Then, run `bundle exec rake spec` to run the test suite.

To install this gem on your local machine, run `bundle exec rake install`.

Please check your contributions with RuboCop by running `bundle exec rubocop`.

Releases are built from tags automatically and pushed to [RubyGems.org][rubygems].

[rubygems]: https://rubygems.org/gems/rspec-sonarqube-formatter
[issues]: https://github.com/otherguy/rspec-sonarqube-formatter/issues
[codecov]: https://app.codecov.io/gh/otherguy/rspec-sonarqube-formatter
[codeclimate]: https://codeclimate.com/github/otherguy/rspec-sonarqube-formatter
[sonarcloud]: https://sonarcloud.io/dashboard?id=otherguy_rspec-sonarqube-formatter
[license]: https://github.com/otherguy/rspec-sonarqube-formatter/blob/main/LICENSE.md
